<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Three.js 101 â€” ç¬¬ä¸€è¯¾ï¼ˆå‚æ•°è¶…è¯¦ç»†æ³¨è§£ï¼‰</title>
    <!-- Tailwindï¼ˆCDNï¼›åªç”¨äºç®€æ´ UIï¼Œä¸å½±å“ three.js å­¦ä¹ ï¼‰ -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body
    class="m-0 overflow-hidden bg-gradient-to-br from-[#1e3c72] to-[#2a5298] font-sans"
  >
    <!-- é¡¶éƒ¨æ ‡é¢˜ï¼šä»Šå¤©å­¦ç”Ÿè¦æŒæ¡çš„çŸ¥è¯†ç‚¹ -->
    <div
      class="fixed top-4 left-1/2 -translate-x-1/2 z-10 bg-white/15 text-white px-5 py-2 rounded-xl text-lg font-bold backdrop-blur-md shadow-xl"
    >
      âœ¨ Three.js 101ï¼šä¸‰ä»¶å¥— Â· åŸºæœ¬å‡ ä½• Â· å…‰ç…§ Â· OrbitControls Â· åŠ¨ç”» Â·
      ç‚¹å‡»æ‹¾å–
    </div>

    <!-- å³ä¸Šè§’æ“ä½œæç¤º -->
    <div
      class="fixed top-4 right-4 z-10 text-[#e9f2ff] opacity-95 bg-white/10 px-3 py-2 rounded-lg text-xs backdrop-blur-md border border-white/20"
    >
      ğŸ–± å·¦é”®æ‹–åŠ¨=æ—‹è½¬ç›¸æœº Â· æ»šè½®=ç¼©æ”¾<br />
      ğŸ‘† ç‚¹å‡»ç‰©ä½“=æ˜¾ç¤ºä¿¡æ¯å¹¶é—ªçƒ<br />
      âŒ¨ï¸ G=ç½‘æ ¼ Â· X=åæ ‡è½´ Â· C=ç›¸æœºè§†é”¥
    </div>

    <!-- å·¦ä¸‹è§’ä¿¡æ¯å¡ï¼šç‚¹å‡»åæ˜¾ç¤ºåç§°ä¸åæ ‡ -->
    <div
      id="infoBox"
      class="fixed bottom-5 left-5 z-10 hidden bg-white/15 text-white px-4 py-3 rounded-lg text-sm backdrop-blur-md shadow-xl"
    >
      <b id="objName">Object</b><br />
      <span id="objPos"></span>
    </div>

    <!-- three.js r124ï¼ˆä¸ examples æ§ä»¶ç‰ˆæœ¬åŒ¹é…ï¼Œè¯¾å ‚æœ€ç¨³çš„æ—§å¼ <script> å¼•å…¥ï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.124.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.124.0/examples/js/controls/OrbitControls.js"></script>

    <script>
      // =========================================================
      // 1) ä¸‰ä»¶å¥—ï¼šScene / Camera / Renderer
      // =========================================================

      // Sceneï¼ˆåœºæ™¯ï¼‰ï¼š3D ä¸–ç•Œçš„å®¹å™¨ï¼Œæ‰€æœ‰ç‰©ä½“éƒ½è¦ add åˆ°è¿™é‡Œ
      const scene = new THREE.Scene();

      // Cameraï¼ˆç›¸æœºï¼‰ï¼šå†³å®šâ€œæ€ä¹ˆæ‹â€åœºæ™¯
      // PerspectiveCamera( fov,                     aspect,                          near,  far )
      //                    å‚ç›´è§†åœºè§’(åº¦ï¼Œè¶Šå¤§è¶Šå¹¿)  ç”»é¢å®½é«˜æ¯”=ç”»å¸ƒå®½/ç”»å¸ƒé«˜        è¿‘è£å‰ªé¢  è¿œè£å‰ªé¢
      const camera = new THREE.PerspectiveCamera(
        75, // fovï¼šå‚ç›´è§†åœºè§’ï¼ˆdegreesï¼‰ã€‚75â‰ˆè½»åº¦å¹¿è§’ï¼›è¶Šå¤§è§†é‡è¶Šå¹¿/é€è§†è¶Šå¼ºï¼›è¶Šå°åƒâ€œé•¿ç„¦â€
        window.innerWidth / window.innerHeight, // aspectï¼šå¿…é¡»ç­‰äºç”»å¸ƒå®½é«˜æ¯”ï¼Œå¦åˆ™ç”»é¢è¢«æ‹‰ä¼¸ã€‚çª—å£å˜åŒ–è¦æ›´æ–°å¹¶è°ƒç”¨ updateProjectionMatrix()
        0.1, // nearï¼šç¦»ç›¸æœºå°äº 0.1 çš„å†…å®¹ç›´æ¥ä¸æ¸²æŸ“ï¼›near è¿‡å°ä¼šé™ä½æ·±åº¦ç²¾åº¦ï¼ˆæ˜“ Z-fightingï¼‰
        1000, // farï¼šç¦»ç›¸æœºå¤§äº 1000 çš„å†…å®¹ä¸æ¸²æŸ“ï¼›è¶Šå¤§è¶Šâ€œèƒ½çœ‹è¿œâ€ï¼Œä½†æ·±åº¦ç²¾åº¦è¶Šå·®
      );

      // æŠŠç›¸æœºæ‘†åˆ°ä¸–ç•Œåæ ‡ (x=4, y=4, z=6)
      // three.js å³æ‰‹åæ ‡ç³»ï¼š+X å³ã€+Y ä¸Šã€+Z æœå‘ä½ ï¼ˆå±å¹•å¤–â†’ä½ ï¼‰ï¼Œç›¸æœºé»˜è®¤æœ -Z çœ‹è¿‡å»
      camera.position.set(4, 4, 6);

      // Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰ï¼šæŠŠ 3D åœºæ™¯ç”»åˆ° <canvas> ä¸Š
      // WebGLRenderer({ antialias })ï¼šantialias=true å¼€å¯ MSAA æŠ—é”¯é½¿ï¼Œè¾¹ç¼˜æ›´å¹³æ»‘ï¼Œç¨è€—æ€§èƒ½
      const renderer = new THREE.WebGLRenderer({ antialias: true });
      // setPixelRatio(dpr)ï¼šé«˜ DPI å±æ›´æ¸…æ™°ï¼Œä½†åƒç´ å¡«å……æˆæœ¬ ~ dpr^2ï¼Œå– min(dpr, 2) åœ¨æ¸…æ™°ä¸æ€§èƒ½ä¹‹é—´æŠ˜ä¸­
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      // setSize(w, h)ï¼šè®¾ç½®ç”»å¸ƒå°ºå¯¸ã€‚è‹¥ä¸è®¾ï¼Œcanvas é»˜è®¤ä¸º 300x150
      renderer.setSize(window.innerWidth, window.innerHeight);
      // æŠŠ canvas æ’å…¥é¡µé¢
      document.body.appendChild(renderer.domElement);
      // é¿å… canvas ä½œä¸º inline å…ƒç´ å‡ºç°åŸºçº¿ç¼éš™ï¼ˆä¹Ÿå¯ç”¨ CSSï¼šcanvas{display:block}ï¼‰
      renderer.domElement.style.display = 'block';

      // =========================================================
      // 2) OrbitControlsï¼šè®©â€œç›¸æœºâ€æ”¯æŒé¼ æ ‡æ—‹è½¬/ç¼©æ”¾/å¹³ç§»ï¼ˆç‰©ä½“æ²¡åŠ¨ï¼Œç›¸æœºåœ¨åŠ¨ï¼‰
      //    new OrbitControls( camera, domElement )
      //                      ä½ è¦æ§åˆ¶çš„ç›¸æœº  æ¥å—äº¤äº’äº‹ä»¶çš„ DOMï¼ˆé€šå¸¸æ˜¯ renderer.domElementï¼‰
      // =========================================================
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true; // é˜»å°¼ï¼ˆæƒ¯æ€§ï¼‰æ•ˆæœï¼šæ›´é¡ºæ»‘ã€‚æ³¨æ„ï¼šéœ€è¦åœ¨åŠ¨ç”»å¾ªç¯é‡Œæ¯å¸§ controls.update()

      // =========================================================
      // 3) å…‰ç…§ï¼šPBR æè´¨ï¼ˆMeshStandard/Physicalï¼‰éœ€è¦å…‰æºæ‰æœ‰è´¨æ„Ÿ
      // =========================================================
      // AmbientLight( color, intensity )
      scene.add(new THREE.AmbientLight(0xffffff, 0.4)); // ç¯å¢ƒå…‰ï¼šå…¨å±€å‡åŒ€æäº®ï¼Œå¼ºåº¦ 0.4

      // DirectionalLight( color, intensity )ï¼šå¹³è¡Œå…‰ï¼Œç±»ä¼¼å¤ªé˜³å…‰ï¼Œæœ‰æ–¹å‘ã€‚å¯æŠ•å°„æ–¹å‘æ€§é˜´å½±ï¼ˆæ­¤å¤„æœªå¼€ï¼‰
      const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
      dirLight.position.set(5, 5, 5); // ä»å³ä¸Šæ–¹æ‰“å…‰
      scene.add(dirLight);

      // =========================================================
      // 4) åœ°é¢ + ç½‘æ ¼ + åæ ‡è½´ + ç›¸æœºè§†é”¥ï¼ˆæ•™å­¦è¾…åŠ©ï¼‰
      // =========================================================
      // PlaneGeometry( width, height )
      // MeshStandardMaterial({ color, roughness, metalness, ... })
      const ground = new THREE.Mesh(
        new THREE.PlaneGeometry(20, 20), // 20x20 çš„åœ°é¢
        new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.8 }), // ç²—ç³™æš—ç°
      );
      ground.rotation.x = -Math.PI / 2; // è®©å¹³é¢ä»ç«–ç›´è½¬ä¸ºæ°´å¹³ï¼ˆ-90Â°ï¼‰
      scene.add(ground);

      // GridHelper( size, divisions, colorCenterLine, colorGrid )
      const grid = new THREE.GridHelper(20, 20, 0x88a, 0x556);
      grid.position.y = 0.001; // ç¨å¾®æŠ¬é«˜ï¼Œé¿å…ä¸åœ°é¢â€œæ·±åº¦å†²çªâ€é—ªçƒ
      scene.add(grid);

      // AxesHelper( size )ï¼šX=çº¢ã€Y=ç»¿ã€Z=è“
      const axes = new THREE.AxesHelper(2.5);
      axes.visible = true;
      scene.add(axes);

      // CameraHelper( camera )ï¼šå¯è§†åŒ–ç›¸æœºè§†é”¥ï¼ˆnear/far/fov çš„çœŸå®ä½“ç§¯ï¼‰
      const camHelper = new THREE.CameraHelper(camera);
      camHelper.visible = false; // é»˜è®¤å…³é—­ï¼ŒæŒ‰ C é”®åˆ‡æ¢
      scene.add(camHelper);

      // =========================================================
      // 5) åŸºæœ¬å‡ ä½•ä½“ï¼ˆå‚æ•°è§£é‡Šï¼‰
      // =========================================================
      // BoxGeometry( width, height, depth )
      const cube = new THREE.Mesh(
        new THREE.BoxGeometry(1, 1, 1), // å®½1 é«˜1 æ·±1
        new THREE.MeshStandardMaterial({ color: 0x66ccff }), // è“è‰²ï¼Œå—å…‰
      );
      // è®©ç«‹æ–¹ä½“â€œååœ¨åœ°ä¸Šâ€ï¼šy=0.5ï¼ˆ=åŠé«˜ï¼‰
      cube.position.set(-2, 0.5, 0);
      cube.name = 'Cube';

      // SphereGeometry( radius, widthSegments, heightSegments )
      const sphere = new THREE.Mesh(
        new THREE.SphereGeometry(0.7, 32, 32), // åŠå¾„0.7ï¼Œæ°´å¹³&å‚ç›´ç»†åˆ†=32ï¼ˆè¶Šå¤§è¶Šåœ†æ¶¦ï¼‰
        new THREE.MeshStandardMaterial({ color: 0xff7777 }), // çº¢è‰²ï¼Œå—å…‰
      );
      // çƒå¿ƒåœ¨ y=åŠå¾„ 0.7ï¼Œåˆšå¥½â€œè´´åœ°â€
      sphere.position.set(0, 0.7, 0);
      sphere.name = 'Sphere';

      // CylinderGeometry( radiusTop, radiusBottom, height, radialSegments )
      const cylinder = new THREE.Mesh(
        new THREE.CylinderGeometry(0.6, 0.6, 1.5, 32), // ä¸ŠåŠå¾„0.6ï¼Œä¸‹åŠå¾„0.6ï¼Œé«˜1.5ï¼Œåœ†å‘¨åˆ†æ®µ32
        new THREE.MeshStandardMaterial({ color: 0x88ff88 }), // ç»¿è‰²ï¼Œå—å…‰
      );
      // y=åŠé«˜ 0.75 è´´åœ°
      cylinder.position.set(2, 0.75, 0);
      cylinder.name = 'Cylinder';

      scene.add(cube, sphere, cylinder);

      // =========================================================
      // 6) Raycasterï¼šç‚¹å‡»æ‹¾å–ï¼ˆé¼ æ ‡åƒç´  â†’ è§„èŒƒåŒ–è®¾å¤‡åæ ‡ NDC â†’ ä»ç›¸æœºå‘å°„å°„çº¿ â†’ ä¸ç‰©ä½“æ±‚äº¤ï¼‰
      // =========================================================
      const infoBox = document.getElementById('infoBox');
      const objNameEl = document.getElementById('objName');
      const objPosEl = document.getElementById('objPos');

      const raycaster = new THREE.Raycaster(); // å…‰çº¿æŠ•å°„å™¨
      const mouse = new THREE.Vector2(); // å­˜æ”¾ NDCï¼ˆèŒƒå›´ -1~1ï¼‰

      function updateMouseNDC(e) {
        // åƒç´ åæ ‡ï¼ˆå·¦ä¸Šè§’ä¸º 0,0ï¼‰ â†’ å½’ä¸€åŒ–åˆ° [-1,1]ï¼Œä¸”ä»¥å±å¹•ä¸­å¿ƒä¸º 0,0
        mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
      }

      renderer.domElement.addEventListener('click', (e) => {
        updateMouseNDC(e);
        // setFromCamera( ndc, camera )ï¼šæŠŠâ€œé¼ æ ‡æ‰€åœ¨å±å¹•ç‚¹â€æ˜ å°„åˆ° 3D ç©ºé—´çš„ä¸€æ¡å°„çº¿ï¼ˆç”±ç›¸æœºå‘å‡ºï¼‰
        raycaster.setFromCamera(mouse, camera);
        // intersectObjects( objectsArray, recursive? )ï¼šä¸ç»™å®šç‰©ä½“æ•°ç»„æ±‚äº¤ï¼›ç¬¬äºŒå‚ç”¨äºæ˜¯å¦é€’å½’éå†å­å±‚çº§
        const hits = raycaster.intersectObjects(
          [cube, sphere, cylinder],
          false,
        );
        if (hits.length > 0) {
          const obj = hits[0].object; // æœ€è¿‘çš„å‘½ä¸­å¯¹è±¡
          // æ›´æ–°ä¿¡æ¯å¡
          objNameEl.textContent = obj.name || 'Object';
          objPosEl.textContent = `ä½ç½®: (${obj.position.x.toFixed(
            2,
          )}, ${obj.position.y.toFixed(2)}, ${obj.position.z.toFixed(2)})`;
          infoBox.classList.remove('hidden');

          // è§†è§‰åé¦ˆï¼šé—ªçƒä¸ºé»„è‰² 300ms
          const old = obj.material.color.clone();
          obj.material.color.set(0xffff00);
          setTimeout(() => obj.material.color.copy(old), 300);
        }
      });

      // =========================================================
      // 7) åŠ¨ç”»å¾ªç¯ï¼šæ¯å¸§æ›´æ–°ï¼ˆç›¸æœºé˜»å°¼/å°åŠ¨ç”»ï¼‰å¹¶æ¸²æŸ“
      // =========================================================
      const clock = new THREE.Clock(); // è®¡æ—¶å™¨ï¼šç”¨æ—¶é—´åšå¹³æ»‘åŠ¨ç”»
      function animate() {
        requestAnimationFrame(animate); // æµè§ˆå™¨ä¸‹ä¸€å¸§æ—¶å†æ¬¡è°ƒç”¨ï¼ˆå½¢æˆå¾ªç¯ï¼‰

        const t = clock.getElapsedTime(); // ä»å¯åŠ¨åˆ°ç°åœ¨çš„ç§’æ•°

        // è½»é‡æ¼”ç¤ºåŠ¨ç”»ï¼šä¾¿äºè¯´æ˜â€œæ¯å¸§åœ¨æ›´æ–°â€
        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        cylinder.rotation.x += 0.005;
        sphere.position.y = 0.7 + Math.sin(t * 2) * 0.2; // æ­£å¼¦ä¸Šä¸‹æµ®åŠ¨

        controls.update(); // å¼€å¯äº†é˜»å°¼ï¼ˆenableDampingï¼‰å¿…é¡»æ¯å¸§è°ƒç”¨
        renderer.render(scene, camera); // æŠŠå½“å‰è¿™ä¸€å¸§ç”»åˆ°å±å¹•
      }
      animate(); // å¯åŠ¨å¾ªç¯

      // =========================================================
      // 8) è‡ªé€‚åº”çª—å£ï¼šä¿æŒç”»é¢ä¸æ‹‰ä¼¸ï¼ˆé‡ç®—ç›¸æœºæŠ•å½±çŸ©é˜µ + è°ƒæ•´ç”»å¸ƒå°ºå¯¸ï¼‰
      // =========================================================
      window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight; // é‡æ–°è®¡ç®—å®½é«˜æ¯”
        camera.updateProjectionMatrix(); // å¿…é¡»ï¼šè®©ç›¸æœºæŒ‰æ–°å®½é«˜æ¯”é‡ç®—æŠ•å½±çŸ©é˜µ
        renderer.setSize(window.innerWidth, window.innerHeight); // åŒæ­¥ canvas å°ºå¯¸
      });

      // =========================================================
      // 9) æ•™å­¦å¿«æ·é”®ï¼šG=ç½‘æ ¼ Â· X=åæ ‡è½´ Â· C=ç›¸æœºè§†é”¥
      // =========================================================
      window.addEventListener('keydown', (e) => {
        const k = e.key.toLowerCase();
        if (k === 'g') grid.visible = !grid.visible;
        if (k === 'x') axes.visible = !axes.visible;
        if (k === 'c') camHelper.visible = !camHelper.visible;
      });
    </script>
  </body>
</html>
